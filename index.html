<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ruang ucapan & Kasih</title>
  <meta name="robots" content="index,follow" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Tema pink + pattern mawar halus; teks default hitam */
    body {
      color: #000;
      background:
        radial-gradient(900px 500px at 110% -10%, rgba(255,182,193,.18), transparent 60%),
        radial-gradient(900px 500px at -10% 110%, rgba(255,228,232,.22), transparent 60%),
        linear-gradient(180deg, #ffffff 0%, #ffeaf0 55%, #ffffff 100%);
    }
    .rose-pattern {
      position: fixed; inset: 0; pointer-events: none; opacity: .22;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 64 64"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop stop-color="%23ff6b9c" offset="0"/><stop stop-color="%23ffc1d0" offset="1"/></linearGradient></defs><g fill="url(%23g)" opacity=".85"><circle cx="32" cy="28" r="14"/><path d="M18 36c6-4 22-4 28 0-8 7-20 7-28 0z" opacity=".9"/></g></svg>');
      background-repeat: repeat;
      background-size: 120px;
      mask-image: radial-gradient(ellipse at center, rgba(0,0,0,.35) 0%, rgba(0,0,0,0) 70%);
    }
    .card {
      background: rgba(255,255,255,.9);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(244, 63, 94, .15);
    }
  </style>
</head>
<body class="text-black">
  <div class="rose-pattern"></div>

  <div class="min-h-screen">
    <div class="max-w-4xl mx-auto px-4 py-10 md:py-14">
      <!-- HERO -->
      <header class="relative overflow-hidden rounded-3xl card shadow-sm">
        <div class="p-8 md:p-10">
          <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight">
            Ruang ucapan & Kasih
          </h1>
          <p class="mt-2 text-sm md:text-base opacity-80">
            Tinggalkan salam hangat & doa terbaik Anda.
          </p>
        </div>
      </header>

      <!-- ALERT -->
      <div id="alert" class="hidden mt-6 mb-4 rounded-2xl border px-4 py-3 text-sm"></div>

      <!-- FORM UCAPAN -->
      <form id="guestForm" class="mt-6 rounded-3xl card shadow-sm p-5 md:p-6">
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nama <span class="text-rose-600">*</span></label>
            <input id="nama" required placeholder="Nama lengkap"
                   class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60" />
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Kehadiran <span class="text-rose-600">*</span></label>
            <select id="kehadiran" required
                    class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60">
              <option value="">-- pilih --</option>
              <option>Hadir</option>
              <option>Izin</option>
              <option>Belum Pasti</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Jumlah Tamu <span class="text-rose-600">*</span></label>
            <input id="jumlah" type="number" min="1" value="1" required
                   class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60" />
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Nomor WA <span class="text-rose-600">*</span></label>
            <input id="kontak" required placeholder="Contoh: 0821xxxxxxx"
                   class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60" />
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-medium mb-1">Ucapan</label>
            <textarea id="ucapan" rows="4"
              placeholder="Tulis Pesan & do'a terbaik untuk kedua mempelai"
              class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60"></textarea>
          </div>
        </div>

        <div class="flex gap-3 pt-5">
          <button type="submit" class="flex items-center gap-2 rounded-2xl bg-rose-600 text-white px-5 py-2.5 hover:bg-rose-700 shadow-md shadow-rose-200 transition">
            <span>‚ù§Ô∏è</span> Kirim
          </button>
          <button type="button" id="resetBtn" class="rounded-2xl border border-rose-200 px-5 py-2.5 hover:bg-rose-50">
            Reset
          </button>
        </div>
      </form>

      <!-- PILIHAN TANDA KASIH -->
      <section class="mt-8 rounded-3xl card shadow-sm p-5 md:p-6" id="donasi">
        <h2 class="text-lg font-semibold mb-2">Kirim Tanda Kasih</h2>
        <p class="text-sm opacity-80 mb-4">Pilih metode transfer:</p>

        <div class="space-y-3">
          <label class="flex items-center gap-2">
            <input type="radio" name="payMethod" value="bsi" checked class="text-rose-600 focus:ring-rose-500">
            <span>Transfer Bank (BSI)</span>
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="payMethod" value="ovo" class="text-rose-600 focus:ring-rose-500">
            <span>OVO</span>
          </label>
        </div>

        <div id="payDetail" class="mt-4 p-4 rounded-2xl border border-rose-200 bg-rose-50/50 text-sm">
          <p>Pilih metode di atas untuk melihat detail transfer.</p>
        </div>
      </section>

      <!-- FORM KONFIRMASI PEMBAYARAN -->
      <section class="mt-6 rounded-3xl card shadow-sm p-5 md:p-6" id="konfirmasi">
        <h2 class="text-lg font-semibold mb-2">Konfirmasi Pembayaran</h2>
        <p class="text-sm opacity-80 mb-4">Isi form ini setelah melakukan transfer agar kami mudah memverifikasi.</p>

        <form id="payConfirmForm" class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nama Pengirim <span class="text-rose-600">*</span></label>
            <input id="pc_nama" required placeholder="Nama sesuai rekening / akun"
                   class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60" />
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Metode <span class="text-rose-600">*</span></label>
            <select id="pc_metode" required
                    class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60">
              <option value="">-- pilih --</option>
              <option>BSI</option>
              <option>OVO</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Nominal (Rp) <span class="text-rose-600">*</span></label>
            <input id="pc_nominal" type="number" min="1000" step="1000" required placeholder="Contoh: 50000"
                   class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60" />
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Tanggal Transfer</label>
            <input id="pc_tanggal" type="date"
                   class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60" />
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-medium mb-1">Catatan (opsional)</label>
            <textarea id="pc_catatan" rows="3" placeholder="Keterangan tambahan (opsional)"
                      class="w-full rounded-2xl border border-rose-200/70 px-3 py-2 outline-none focus:ring-4 focus:ring-pink-200/60"></textarea>
          </div>

          <div class="md:col-span-2 flex gap-3 pt-1">
            <button type="submit" class="flex items-center gap-2 rounded-2xl bg-rose-600 text-white px-5 py-2.5 hover:bg-rose-700 shadow-md shadow-rose-200 transition">
              <span>‚úÖ</span> Kirim Konfirmasi
            </button>
            <button type="button" id="pc_reset" class="rounded-2xl border border-rose-200 px-5 py-2.5 hover:bg-rose-50">
              Reset
            </button>
          </div>
        </form>
      </section>
    </div>
  </div>

  <!-- MODAL SUKSES (dipakai untuk ucapan & konfirmasi) -->
  <div id="successModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/30">
    <div class="bg-white w-full max-w-md rounded-3xl shadow-xl p-6 border border-rose-100">
      <h3 class="text-lg font-semibold mb-2">Terkirim üéâ</h3>
      <pre id="successSummary" class="text-sm bg-rose-50 border border-rose-100 rounded-xl p-3 whitespace-pre-wrap mb-4"></pre>
      <div class="flex justify-end gap-2">
        <a href="#donasi" id="goDonate" class="rounded-xl border border-rose-200 px-4 py-2 hover:bg-rose-50">Kirim Tanda Kasih</a>
        <button id="closeModal" class="rounded-xl bg-rose-600 text-white px-4 py-2 hover:bg-rose-700">Tutup</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const alertBox = $("alert");

    function showAlert(text, ok = true) {
      alertBox.textContent = text;
      alertBox.className =
        "mt-6 mb-4 rounded-2xl border px-4 py-3 text-sm " +
        (ok
          ? "border-emerald-200 bg-emerald-50 text-emerald-800"
          : "border-rose-200 bg-rose-50 text-rose-800");
      alertBox.classList.remove("hidden");
      setTimeout(() => alertBox.classList.add("hidden"), 2400);
    }

    /* ====== FORM UCAPAN ====== */
    function currentData() {
      return {
        nama: $("nama").value.trim(),
        kehadiran: $("kehadiran").value,
        jumlah: ($("jumlah").value || "1").replace(/[^0-9]/g, ""),
        kontak: $("kontak").value.trim(),
        ucapan: $("ucapan").value.trim(),
      };
    }
    function validate(d) {
      if (!d.nama) return "Nama wajib diisi";
      if (!d.kehadiran) return "Kehadiran wajib diisi";
      if (!d.kontak) return "Nomor WA wajib diisi";
      const j = parseInt(d.jumlah, 10);
      if (!Number.isFinite(j) || j < 1) return "Jumlah minimal 1";
      return "";
    }
    function buildSummary(d) {
      const lines = [
        `Nama: ${d.nama}`,
        `Kehadiran: ${d.kehadiran}`,
        `Jumlah: ${parseInt(d.jumlah,10)||1}`,
        d.kontak ? `Nomor WA: ${d.kontak}` : "",
        d.ucapan ? `Pesan/Do'a: ${d.ucapan}` : "",
      ].filter(Boolean);
      return lines.join("\n");
    }

    document.getElementById("guestForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = currentData();
      const err = validate(data);
      if (err) return showAlert(err, false);

      try {
        const res = await fetch("/api/send-telegram", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            nama: data.nama,
            kehadiran: data.kehadiran,
            jumlah: parseInt(data.jumlah, 10) || 1,
            kontak: data.kontak,
            ucapan: data.ucapan,
          }),
        });

        if (!res.ok) {
          const t = await res.json().catch(() => ({}));
          return showAlert("Gagal mengirim: " + (t.error || res.statusText), false);
        }

        $("nama").value = "";
        $("kehadiran").value = "";
        $("jumlah").value = "1";
        $("kontak").value = "";
        $("ucapan").value = "";

        $("successSummary").textContent = buildSummary(data);
        $("successModal").classList.remove("hidden");
      } catch {
        showAlert("Terjadi kesalahan jaringan.", false);
      }
    });

    $("resetBtn").addEventListener("click", () => {
      $("nama").value = "";
      $("kehadiran").value = "";
      $("jumlah").value = "1";
      $("kontak").value = "";
      $("ucapan").value = "";
    });

    $("closeModal").addEventListener("click", () => {
      $("successModal").classList.add("hidden");
    });
    $("goDonate").addEventListener("click", () => {
      $("successModal").classList.add("hidden");
      const sec = document.getElementById("donasi");
      if (sec) sec.scrollIntoView({ behavior: "smooth" });
    });

    /* ====== DETAIL METODE TANDA KASIH (BSI / OVO) ====== */
    const paymentDetails = {
      bsi: "Bank Syariah Indonesia (BSI)\nNo.Rek: 7195450433\nA.N: Jabir",
      ovo: "No. OVO: 082122346705\nNama: Jabir"
    };
    const radios = document.querySelectorAll("input[name='payMethod']");
    const detailBox = document.getElementById("payDetail");

    function renderPayDetail(key) {
      const content = paymentDetails[key];
      detailBox.innerHTML = `
        <div class="flex items-start justify-between gap-3">
          <div class="text-sm whitespace-pre-wrap">${content}</div>
          <button class="shrink-0 rounded-xl border border-rose-200 px-3 py-1.5 hover:bg-rose-50" id="copyBtn">Salin</button>
        </div>`;
      document.getElementById("copyBtn").onclick = async () => {
        try {
          await navigator.clipboard.writeText(content);
          showAlert("Detail disalin.");
        } catch {
          showAlert("Gagal menyalin.", false);
        }
      };
    }
    radios.forEach(r => r.addEventListener("change", () => {
      const val = document.querySelector("input[name='payMethod']:checked").value;
      renderPayDetail(val);
    }));
    renderPayDetail("bsi");

    /* ====== FORM KONFIRMASI PEMBAYARAN ====== */
    function pcData() {
      return {
        nama: $("pc_nama").value.trim(),
        metode: $("pc_metode").value,
        nominal: ($("pc_nominal").value || "").replace(/[^0-9]/g, ""),
        tanggal: $("pc_tanggal").value,
        catatan: $("pc_catatan").value.trim(),
      };
    }
    function pcValidate(d) {
      if (!d.nama) return "Nama pengirim wajib diisi";
      if (!d.metode) return "Metode wajib dipilih";
      const n = parseInt(d.nominal, 10);
      if (!Number.isFinite(n) || n < 1000) return "Nominal minimal 1.000";
      return "";
    }
    function pcSummary(d) {
      const rupiah = d.nominal ? `Rp${Number(d.nominal).toLocaleString("id-ID")}` : "";
      const lines = [
        "Konfirmasi Pembayaran",
        `Nama Pengirim: ${d.nama}`,
        `Metode: ${d.metode}`,
        rupiah ? `Nominal: ${rupiah}` : "",
        d.tanggal ? `Tanggal: ${d.tanggal}` : "",
        d.catatan ? `Catatan: ${d.catatan}` : "",
      ].filter(Boolean);
      return lines.join("\n");
    }

    document.getElementById("payConfirmForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const d = pcData();
      const err = pcValidate(d);
      if (err) return showAlert(err, false);

      try {
        const res = await fetch("/api/send-telegram", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            tipe: "konfirmasi_pembayaran",
            nama_pengirim: d.nama,
            metode: d.metode,
            nominal: parseInt(d.nominal, 10) || undefined,
            tanggal: d.tanggal || undefined,
            catatan: d.catatan || undefined
          })
        });

        if (!res.ok) {
          const t = await res.json().catch(() => ({}));
          return showAlert("Konfirmasi gagal dikirim: " + (t.error || res.statusText), false);
        }

        $("pc_nama").value = "";
        $("pc_metode").value = "";
        $("pc_nominal").value = "";
        $("pc_tanggal").value = "";
        $("pc_catatan").value = "";

        $("successSummary").textContent = pcSummary(d);
        $("successModal").classList.remove("hidden");
      } catch {
        showAlert("Terjadi kesalahan jaringan.", false);
      }
    });

    document.getElementById("pc_reset").addEventListener("click", () => {
      $("pc_nama").value = "";
      $("pc_metode").value = "";
      $("pc_nominal").value = "";
      $("pc_tanggal").value = "";
      $("pc_catatan").value = "";
    });

    // set default tanggal hari ini
    (function setToday() {
      const el = $("pc_tanggal");
      if (!el) return;
      const t = new Date();
      const y = t.getFullYear();
      const m = String(t.getMonth()+1).padStart(2,"0");
      const d = String(t.getDate()).padStart(2,"0");
      el.value = `${y}-${m}-${d}`;
    })();
  </script>
</body>
</html>
