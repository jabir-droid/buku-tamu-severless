<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buku Tamu ‚Üí Telegram (Serverless)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <div class="min-h-screen bg-gradient-to-b from-slate-50 to-white">
    <div class="max-w-4xl mx-auto px-4 py-10">
      <header class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Buku Tamu ‚Üí Telegram</h1>
        <p class="text-slate-600">Data dikirim aman via server Vercel.</p>
      </header>

      <!-- ALERT (fallback) -->
      <div id="alert" class="hidden mb-4 rounded-xl border px-4 py-3 text-sm"></div>

      <!-- FORM -->
      <form id="guestForm" class="bg-white rounded-2xl shadow-sm border p-5 md:p-6">
        <div class="grid md:grid-cols-2 gap-4">
          <!-- Nama -->
          <div>
            <label class="block text-sm font-medium mb-1">
              Nama <span class="text-rose-600">*</span>
            </label>
            <input id="nama" required
                   class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-sky-200"
                   placeholder="Nama lengkap" />
          </div>

          <!-- Kehadiran -->
          <div>
            <label class="block text-sm font-medium mb-1">
              Kehadiran <span class="text-rose-600">*</span>
            </label>
            <select id="kehadiran" required
                    class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-sky-200">
              <option value="">-- pilih --</option>
              <option>Hadir</option>
              <option>Izin</option>
              <option>Belum Pasti</option>
            </select>
          </div>

          <!-- Jumlah Tamu -->
          <div>
            <label class="block text-sm font-medium mb-1">
              Jumlah Tamu <span class="text-rose-600">*</span>
            </label>
            <input id="jumlah" type="number" min="1" value="1" required
                   class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-sky-200" />
          </div>

          <!-- Kontak -->
          <div>
            <label class="block text-sm font-medium mb-1">
              Kontak <span class="text-rose-600">*</span>
            </label>
            <input id="kontak" required
                   class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-sky-200"
                   placeholder="Nomor WA / Email / @Instagram" />
          </div>

          <!-- Ucapan -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium mb-1">Ucapan</label>
            <textarea id="ucapan" rows="4"
                      class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-sky-200"
                      placeholder="Tulis ucapan & doa terbaik di sini..."></textarea>
          </div>
        </div>

        <div class="flex gap-3 pt-4">
          <button type="submit"
                  class="rounded-2xl bg-sky-600 text-white px-4 py-2 hover:bg-sky-700 shadow">
            Kirim
          </button>
          <button type="button" id="resetBtn"
                  class="rounded-2xl border px-4 py-2 hover:bg-slate-50">
            Reset
          </button>
        </div>
      </form>
      <!-- /FORM -->

      <!-- KIRIM UANG -->
      <section class="mt-10 bg-white rounded-2xl shadow-sm border p-5 md:p-6">
        <h2 class="text-lg font-semibold mb-2">Ingin kirim uang?</h2>
        <p class="text-sm text-slate-600 mb-4">
          Kamu bisa transfer lewat tombol di bawah atau scan QRIS. Terima kasih üôè
        </p>

        <div class="flex flex-wrap gap-3 mb-4">
          <!-- GANTI href= dengan link asli kamu -->
          <a href="https://link.dana.id/mintadana/CONTOH" target="_blank" rel="noopener"
             class="rounded-xl border px-4 py-2 hover:bg-slate-50">Dana</a>
          <a href="https://saweria.co/CONTOH" target="_blank" rel="noopener"
             class="rounded-xl border px-4 py-2 hover:bg-slate-50">Saweria</a>
          <a href="https://trakteer.id/CONTOH/tip" target="_blank" rel="noopener"
             class="rounded-xl border px-4 py-2 hover:bg-slate-50">Trakteer</a>
          <button id="copyRek" type="button"
             class="rounded-xl border px-4 py-2 hover:bg-slate-50">Salin Rekening</button>
        </div>

        <!-- Ganti src QRIS dengan gambar kamu sendiri (opsional) -->
        <div class="rounded-xl border p-4 flex items-center gap-4">
          <img id="qrisImg" src="" alt="QRIS" class="w-36 h-36 bg-slate-100 rounded-md object-contain">
          <div class="text-sm text-slate-600">
            <p class="mb-1">QRIS (opsional). Taruh URL gambar QRIS kamu di variabel <code>QRIS_URL</code> di bawah.</p>
            <p>Atau klik tombol metode di atas.</p>
          </div>
        </div>
      </section>
      <!-- /KIRIM UANG -->
    </div>
  </div>

  <!-- MODAL SUKSES -->
  <div id="successModal"
       class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/40">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl p-6">
      <h3 class="text-lg font-semibold mb-2">Terkirim üéâ</h3>
      <pre id="successSummary" class="text-sm bg-slate-50 border rounded-lg p-3 whitespace-pre-wrap mb-4"></pre>
      <div class="flex justify-end gap-2">
        <a href="#donate" id="goDonate"
           class="rounded-xl border px-4 py-2 hover:bg-slate-50">Kirim Uang</a>
        <button id="closeModal"
                class="rounded-xl bg-sky-600 text-white px-4 py-2 hover:bg-sky-700">Tutup</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const alertBox = $("alert");

    // ====== CONFIG KIRIM UANG (ganti sesuai punyamu) ======
    const REKENING_TEXT = "BCA 123456789 a.n. Nama Kamu";
    const QRIS_URL = ""; // contoh: "https://domainmu.com/qris.png"
    // =====================================================

    if (QRIS_URL) {
      const img = $("qrisImg");
      img.src = QRIS_URL;
      img.classList.remove("bg-slate-100");
    }

    function showAlert(text, ok = true) {
      alertBox.textContent = text;
      alertBox.className =
        "mb-4 rounded-xl border px-4 py-3 text-sm " +
        (ok
          ? "border-emerald-200 bg-emerald-50 text-emerald-800"
          : "border-rose-200 bg-rose-50 text-rose-800");
      alertBox.classList.remove("hidden");
      setTimeout(() => alertBox.classList.add("hidden"), 2400);
    }

    function currentData() {
      return {
        nama: $("nama").value.trim(),
        kehadiran: $("kehadiran").value,
        jumlah: ($("jumlah").value || "1").replace(/[^0-9]/g, ""),
        kontak: $("kontak").value.trim(),
        ucapan: $("ucapan").value.trim(),
      };
    }

    function validate(d) {
      if (!d.nama) return "Nama wajib diisi";
      if (!d.kehadiran) return "Kehadiran wajib diisi";
      if (!d.kontak) return "Kontak wajib diisi";
      const j = parseInt(d.jumlah, 10);
      if (!Number.isFinite(j) || j < 1) return "Jumlah minimal 1";
      return "";
    }

    function buildSummary(d) {
      const lines = [
        `Nama: ${d.nama}`,
        `Kehadiran: ${d.kehadiran}`,
        `Jumlah: ${parseInt(d.jumlah,10)||1}`,
        d.kontak ? `Kontak: ${d.kontak}` : "",
        d.ucapan ? `Ucapan: ${d.ucapan}` : "",
      ].filter(Boolean);
      return lines.join("\n");
    }

    $("guestForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = currentData();
      const err = validate(data);
      if (err) return showAlert(err, false);

      try {
        const res = await fetch("/api/send-telegram", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            nama: data.nama,
            kehadiran: data.kehadiran,
            jumlah: parseInt(data.jumlah, 10) || 1,
            kontak: data.kontak,
            ucapan: data.ucapan,
          }),
        });

        if (!res.ok) {
          const t = await res.json().catch(() => ({}));
          return showAlert("Gagal mengirim: " + (t.error || res.statusText), false);
        }

        // reset form
        $("nama").value = "";
        $("kehadiran").value = "";
        $("jumlah").value = "1";
        $("kontak").value = "";
        $("ucapan").value = "";

        // tampilkan modal sukses + ringkasan
        $("successSummary").textContent = buildSummary(data);
        $("successModal").classList.remove("hidden");
      } catch {
        showAlert("Terjadi kesalahan jaringan.", false);
      }
    });

    $("resetBtn").addEventListener("click", () => {
      $("nama").value = "";
      $("kehadiran").value = "";
      $("jumlah").value = "1";
      $("kontak").value = "";
      $("ucapan").value = "";
    });

    $("closeModal").addEventListener("click", () => {
      $("successModal").classList.add("hidden");
    });

    $("goDonate").addEventListener("click", () => {
      $("successModal").classList.add("hidden");
      // scroll ke bagian donasi
      const sec = document.querySelector("section.mt-10");
      if (sec) sec.scrollIntoView({ behavior: "smooth" });
    });

    $("copyRek").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(REKENING_TEXT);
        showAlert("Nomor rekening disalin.", true);
      } catch {
        showAlert("Gagal menyalin. Salin manual: " + REKENING_TEXT, false);
      }
    });
  </script>
</body>
</html>
